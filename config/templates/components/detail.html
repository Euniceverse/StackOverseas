{% load static %}
<link rel="stylesheet" href="{% static 'detail.css' %}">
<script src="{% static 'js/calendar.js' %}" defer></script>
<!-- ğŸ¯ ì´ë²¤íŠ¸ ìƒì„¸ ëª¨ë‹¬ -->
<div id="event-detail-modal" class="event-modal hidden">
    <div class="event-modal-content">
        
        <!-- âŒ ë‹«ê¸° ë²„íŠ¼ -->
        <button id="event-detail-close" class="modal-close">&times;</button>

        <!-- ğŸ“Œ ì´ë²¤íŠ¸ ì œëª© -->
        <h2 id="event-name" class="event-title">Event Name</h2>
        <p id="event-type" class="event-subtitle">Event Type</p>

        <!-- ğŸ“… ë‚ ì§œ ë° ì‹œê°„ -->
        <div class="event-info">
            <p id="event-date">ğŸ“… Date: YYYY-MM-DD</p>
            <p id="event-time">â° Time: HH:MM AM/PM</p>
        </div>

        <!-- ğŸ“ ì¥ì†Œ -->
        <div class="event-info">
            <p id="event-location">ğŸ“ Location: TBD</p>
        </div>

        <!-- ğŸ“– ì„¤ëª… -->
        <div class="event-section">
            <h3>ğŸ“– Description</h3>
            <p id="event-description">Event details will appear here...</p>
        </div>

        <!-- ğŸ« ì£¼ìµœ ë™ì•„ë¦¬ -->
        <div class="event-section">
            <h3>ğŸ« Hosted By</h3>
            <p id="event-hosts">Society Name</p>
        </div>

        <!-- ğŸ‘¥ ì°¸ì—¬ ì •ë³´ -->
        <div class="event-info">
            <p id="event-capacity">ğŸ‘¥ Capacity: {{ event.capacity|default:"Unlimited" }}</p>
            <p id="event-fee">ğŸ’° Fee: Free</p>
            <p id="event-member-only" class="hidden">ğŸ”’ Members Only</p>
        </div>

        <!-- ğŸ“ ì°¸ê°€ ë²„íŠ¼ -->
        <div class="event-action">
            <!-- Payment Form (Hidden) -->
            <form id="paymentForm" action="/payments/checkout/" method="POST">
                {% csrf_token %}
                <input type="hidden" name="event_id" id="event-id-input">
                <input type="hidden" name="name" id="event-name-input">
                <input type="hidden" name="price" id="event-price-input">
                <input type="hidden" name="description" id="event-description-input">
            </form>

            <!-- Register Now Button -->
            <button type="button" id="registerButton" class="register-button btn btn-primary">Register Now</button>

            <script src="https://js.stripe.com/v3/"></script>
            <script>
                const stripe = Stripe("pk_test_51QviGaE1rp8ABg2BZkClndNES4HcFS2yJVKbc10uIfMf9jF6QuuS1TKZ7SgVKU8DK43TXWzQlS1fGcswox4WFuve00bNqjsbvD"); 
            </script>
            <script>
                document.addEventListener("DOMContentLoaded", function () {
                    let registerButton = document.querySelector(".register-button");
                
                    if (registerButton) {
                        registerButton.addEventListener("click", function (event) {
                            event.preventDefault();  // Stop default behavior
                
                            // Fetch event details from the modal
                            let eventId = document.getElementById("event-id-input").value.trim();
                            let name = document.getElementById("event-name").textContent.trim();
                            let price = document.getElementById("event-price-input").value.trim();
                            let description = document.getElementById("event-description").textContent.trim();
                
                            if (!eventId || !name || !price) {
                                console.error("âŒ ERROR: Missing event data!");
                                return;
                            }
                
                            console.log(`ğŸ“¢ Sending data -> ID: ${eventId}, Name: ${name}, Price: ${price}`);
                
                            fetch("/payments/checkout/", {
                                method: "POST",
                                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                                body: new URLSearchParams({
                                    event_id: document.getElementById("event-id-input").value,
                                    name: document.getElementById("event-name").textContent,
                                    price: document.getElementById("event-price-input").value,
                                    description: document.getElementById("event-description").textContent
                                })
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.sessionId) {
                                    console.log("âœ… Redirecting to Stripe...");
                                    window.location.href = `https://checkout.stripe.com/pay/${data.sessionId}`;
                                } else {
                                    console.error("âŒ ERROR: No session ID returned:", data);
                                }
                            })
                            .catch(error => console.error("âŒ ERROR: Checkout request failed!", error));
                        });
                    }
                });
            </script>
        </div>
    </div>
</div>

